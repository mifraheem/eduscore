{% extends "tbase.html" %}
{% block title %}EduScore | Teacher Dashboard{% endblock %}

{% block content %}

<!-- Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-8">
  <div>
    <h1 class="text-2xl font-semibold">Teacher Dashboard</h1>
    <p class="text-gray-500 text-sm">Track your classes, quizzes, and student activity.</p>
  </div>

  <div class="flex flex-wrap gap-2">
    <a href="{% url 'classes' %}" class="bg-primary text-white px-4 py-2 rounded-xl font-semibold hover:bg-primary/90">+ New Class</a>
    <a href="{% url 'upload_material' %}" class="border px-4 py-2 rounded-xl hover:bg-gray-50">Upload Material</a>
    <a href="{% url 'create_quiz' %}" class="border px-4 py-2 rounded-xl hover:bg-gray-50">Create Quiz</a>
  </div>
</div>

<!-- Stats -->
<div class="grid grid-cols-1 sm:grid-cols-5 gap-4 mb-8">
  <div class="bg-white rounded-2xl p-4 border border-gray-100 shadow-sm">
    <p class="text-sm text-gray-500">Total Classes</p>
    <p class="text-2xl font-semibold mt-1">{{ total_classes }}</p>
  </div>
  <div class="bg-white rounded-2xl p-4 border border-gray-100 shadow-sm">
    <p class="text-sm text-gray-500">Active Students</p>
    <p class="text-2xl font-semibold mt-1 text-blue-600">{{ total_students }}</p>
  </div>
  <div class="bg-white rounded-2xl p-4 border border-gray-100 shadow-sm">
    <p class="text-sm text-gray-500">Quizzes Created</p>
    <p class="text-2xl font-semibold mt-1 text-green-600">{{ total_quizzes }}</p>
  </div>
  <div class="bg-white rounded-2xl p-4 border border-gray-100 shadow-sm">
    <p class="text-sm text-gray-500">Materials Uploaded</p>
    <p class="text-2xl font-semibold mt-1 text-purple-600">{{ total_materials }}</p>
  </div>
  <div class="bg-white rounded-2xl p-4 border border-gray-100 shadow-sm">
    <p class="text-sm text-gray-500">Avg. Quiz Score</p>
    <p class="text-2xl font-semibold mt-1 text-yellow-600">{{ avg_score }}%</p>
  </div>
</div>

<div class="grid grid-cols-1 xl:grid-cols-3 gap-6">

<!-- LEFT MAIN CONTENT -->
<div class="xl:col-span-2 space-y-6">

  <!-- Recent Classes -->
  <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">Recent Classes</h2>
      <a href="{% url 'classes' %}" class="text-primary text-sm hover:underline">View All</a>
    </div>

    {% if recent_classes %}
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {% for c in recent_classes %}
        <div class="border rounded-xl p-4 bg-gray-50 hover:bg-gray-100 transition">
          <h3 class="font-medium">{{ c.title }}</h3>
          <p class="text-sm text-gray-500">{{ c.enrollments.count }} Students â€¢ {{ c.quizzes.count }} Quizzes</p>
          <a href="{% url 'class_view' c.id %}" class="mt-3 inline-block bg-primary text-white px-3 py-1 rounded-lg text-sm hover:bg-primary/90">Open Class</a>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-gray-500 text-sm">No classes yet.</p>
    {% endif %}
  </div>

  <!-- Recent Quizzes -->
  <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">Recent Quizzes</h2>
      <a href="{% url 'quiz_list' %}" class="text-primary text-sm hover:underline">View All</a>
    </div>

    {% if recent_quizzes %}
    <table class="min-w-full text-sm">
      <thead>
        <tr class="text-left text-gray-500 border-b">
          <th class="py-2 px-2">Quiz Title</th>
          <th class="py-2 px-2">Class</th>
          <th class="py-2 px-2">Attempts</th>
          <th class="py-2 px-2">Avg. Score</th>
          <th class="py-2 px-2 text-right">Action</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        {% for q in recent_quizzes %}
        <tr>
          <td class="py-3 px-2 font-medium">{{ q.title }}</td>
          <td class="py-3 px-2 text-gray-500">{{ q.course.title }}</td>
          <td class="py-3 px-2">{{ q.attempts.count }}</td>

          {% if q.attempts.count > 0 %}
            <td class="py-3 px-2 text-green-600 font-semibold">
              000
            </td>
          {% else %}
            <td class="py-3 px-2 text-gray-400">--</td>
          {% endif %}

          <td class="py-3 px-2 text-right">
            <a href="#" class="text-primary hover:underline text-sm">View</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-gray-500 text-sm">No quizzes created yet.</p>
    {% endif %}
  </div>

</div>

<!-- RIGHT SIDEBAR -->
<div class="space-y-6">

  <!-- Recent Student Activity -->
  <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
    <h2 class="text-lg font-semibold mb-4">Recent Student Activity</h2>

    {% if recent_activity %}
    <ul class="space-y-3 text-sm text-gray-700">
      {% for a in recent_activity %}
      <li class="flex justify-between border-b pb-2">
        <span>
          <strong>{{ a.student.first_name|default:a.student.email }}</strong>
          submitted <em>{{ a.quiz.title }}</em>
        </span>
        <span class="text-gray-500 text-xs">{{ a.submitted_at|timesince }} ago</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-gray-500 text-sm">No recent activity.</p>
    {% endif %}
  </div>

</div>

</div>

{% endblock %}
